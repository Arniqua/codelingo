tenets:
  - name:  missing-close-file
    flows:
      codelingo/review:
        comment: Close the file when you are done
    query: |
      import codelingo/ast/go
      
      go.func_decl(depth = any):
        @review comment
        go.assign_stmt(depth = any):
          go.lhs:
            go.ident:
              sibling_order == 0
              name as fileName
          go.rhs:
            go.call_expr:
              go.selector_expr:
                go.ident:
                  name == "os"
                any_of:
                  go.ident:
                    name == "Open"
                  go.ident:
                    name == "OpenFile"      
        exclude:
          go.return_stmt(depth = any):
            go.results:
              go.ident:
                name == fileName
          go.func_type:
            go.field_list:
              go.field:
                go.names:
                  go.ident:
                    name == fileName
                go.star_expr:
                  go.selector_expr:
                    go.ident:
                      name == "os"
                    go.ident:
                      name == "File"
        exclude:
          go.call_expr(depth = any):
            go.selector_expr:
              go.ident:
                name ==  fileName
              go.ident:
                name == "Close"    
          go.defer_stmt(depth = any):
            go.call_expr:
              go.selector_expr:
                go.ident:
                  name ==  fileName
                go.ident:
                  name == "Close"          
