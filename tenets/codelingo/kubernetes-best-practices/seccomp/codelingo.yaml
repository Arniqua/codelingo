tenets:
  - name: find-funcs
    flows:
      codelingo/review:
        comment: Here's a docker security policy
    query: |
      import codelingo/ast/yaml

      yaml.file(depth = any):
        yaml.map:
          yaml.mapping:
            yaml.scalar:
              value == "kind"
            yaml.scalar:
              value == "PodSecurityPolicy"
          yaml.mapping:
            yaml.scalar:
              value == "metadata"
            yaml.map:
              yaml.mapping:
                yaml.scalar:
                  value == "annotations"
                yaml.map:
                  @review comment
                  yaml.mapping:
                    yaml.scalar:
                      value == "seccomp.security.alpha.kubernetes.io/allowedProfileNames"
                  yaml.mapping:
                    yaml.scalar:
                      value as seccompPolicy
                      contains(seccompPolicy, "docker/default")
